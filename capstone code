import time
import webbrowser
from http.server import HTTPServer, BaseHTTPRequestHandler
import threading

# Get websites to block from the user
websites_input = input("Enter websites to block (comma-separated, e.g., youtube.com,instagram.com): ")
blocked_sites = [site.strip().lower() for site in websites_input.split(",") if site.strip()]

if not blocked_sites:
    print("No websites provided. Exiting...")
    exit()

# Get focus duration from the user (minutes)
while True:
    try:
        minutes = int(input("Enter focus duration in minutes: "))
        if minutes <= 0:
            print("Please enter a positive number.")
            continue
        break
    except ValueError:
        print("Invalid input. Please enter an integer value.")

study_time = minutes * 60
print(f"Focus mode ON for {minutes} minute(s)! Websites will be blocked.")

# Blocking HTML page
html_content = """
<html>
<head><title>Blocked!</title></head>
<body style="text-align:center; margin-top:50px;">
<h1>ðŸš« This website is blocked during your focus session!</h1>
<p>Stay focused for your own good ðŸ˜‰</p>
</body>
</html>
"""

# HTTP server to serve blocking page
class BlockHandler(BaseHTTPRequestHandler):
    def do_GET(self):
        self.send_response(200)
        self.send_header("Content-type", "text/html")
        self.end_headers()
        self.wfile.write(html_content.encode('utf-8'))

def run_server():
    server_address = ('', 8080)
    httpd = HTTPServer(server_address, BlockHandler)
    httpd.serve_forever()

# Start server in background thread
threading.Thread(target=run_server, daemon=True).start()

# Open blocking pages for each website to simulate blocking
start_time = time.time()
while time.time() - start_time < study_time:
    for site in blocked_sites:
        url = f"http://localhost:8080"
        webbrowser.open(url, new=0)  # open in same browser window if possible
    time.sleep(10)

print("Focus session over! Websites are unblocked now.")
